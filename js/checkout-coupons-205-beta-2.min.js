!function(e,o){"function"==typeof define&&define.amd?define([],o()):"object"==typeof exports?module.exports=o():e.CheckoutCoupons=o()}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";function r(){var e={},o=!1,t=0;for("[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(o=arguments[0],t++);t<arguments.length;t++){c=void 0;var c,n=arguments[t];for(c in n)n.hasOwnProperty(c)&&(o&&"[object Object]"===Object.prototype.toString.call(n[c])?e[c]=r(e[c],n[c]):e[c]=n[c])}return e}function u(e,o){var t=o?o.closest(i.sectionWrapperSelector):null;console.log(o),console.log(t),(o=t?t.querySelector(i.messagesWrapperSelector):document.querySelector(i.generalNoticesSelector))&&(o.innerHTML=e)}function n(){var e=document.querySelector(i.generalNoticesSelector);e&&(e.innerHTML=""),(e=document.querySelector(i.messagesWrapperSelector))&&(e.innerHTML="")}function o(e){var o;e.target.closest(i.addCouponButtonSelector)?(e.preventDefault(),o=e.target.closest(i.addCouponButtonSelector),p(o)):e.target.closest(i.removeCouponButtonSelector)&&(e.preventDefault(),o=e.target.closest(i.removeCouponButtonSelector),f(o))}function t(e){e.defaultPrevented||e.key==a.ENTER&&e.target.closest(i.couponFieldSelector)&&(e.preventDefault(),p(e.target.closest(i.couponFieldSelector)))}function c(){window.addEventListener("click",o),document.addEventListener("keydown",t,!0),document.body.classList.add(i.bodyClass),l=!0}var s=jQuery,l=!1,d={},i={bodyClass:"has-fc-checkout-coupons",uiProcessingClass:"processing",sectionWrapperSelector:".fc-step__substep",generalNoticesSelector:".woocommerce-notices-wrapper",messagesWrapperSelector:".fc-coupon-code-messages",suppressSuccessMessages:"no",couponAddedSectionSelector:".fc-step__substep-text-content--coupon-codes",couponFieldSelector:'input[name="coupon_code"]',addCouponButtonSelector:".fc-coupon-code__apply",removeCouponButtonSelector:".woocommerce-remove-coupon",couponCodeAttribute:"data-coupon",referenceIdAttribute:"data-reference-id",expansibleCouponToggleSelector:".fc-expansible-form-section__toggle--coupon_code",expansibleCouponContentSelector:".fc-expansible-form-section__content--coupon_code",expansibleCouponToggleButtonSelector:".expansible-section__toggle-plus--coupon_code"},a={ENTER:"Enter",SPACE:" "},p=function(e){var o="";if(console.log(e),!(o=e&&e.hasAttribute(i.couponCodeAttribute)?e.getAttribute(i.couponCodeAttribute):o)||""==o){var t=e.closest(".fc-coupon-code-section").querySelector(i.couponFieldSelector);if(!t)return;if(""===t.value.trim())return t.value="",void t.focus();o=t.value}o&&""!=o&&d.addCouponCode(o,e)},f=function(e){var o;e&&(o="",(o=e.hasAttribute(i.couponCodeAttribute)?e.getAttribute(i.couponCodeAttribute):o)&&""!=o&&d.removeCouponCode(o,e))};d.blockUI=function(e){e&&s(e).addClass(i.uiProcessingClass).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},d.unblockUI=function(e){s(e).removeClass(i.uiProcessingClass).unblock()},d.addCouponCode=function(e,o){var t,r;e&&""!=e&&(n(),t=Math.floor(1e3*Math.random()),o&&o.setAttribute(i.referenceIdAttribute,t),o=document.querySelector(i.couponAddedSectionSelector),d.blockUI(o),r={security:i.addCouponCodeNonce,coupon_code:e,reference_id:t},s.ajax({type:"POST",url:fcSettings.wcAjaxUrl.replace("%%endpoint%%","fc_add_coupon_code"),data:r,dataType:"json",success:function(e){var o,t,c,n;e.reference_id&&(o=document.querySelector("["+i.referenceIdAttribute+'="'+e.reference_id+'"]')),e.result&&"success"===e.result?(e.message&&"yes"!==i.suppressSuccessMessages&&u(e.message,o),(t=document.querySelector(i.couponFieldSelector))&&(t.value=""),window.CollapsibleBlock&&(t=document.querySelector(i.expansibleCouponToggleSelector),n=document.querySelector(i.expansibleCouponContentSelector),c=document.querySelector(i.expansibleCouponToggleButtonSelector),t&&n&&(CollapsibleBlock.collapse(n),CollapsibleBlock.expand(t),c&&c.focus())),s(document.body).trigger("wc_fragment_refresh"),s(document.body).trigger("applied_coupon_in_checkout",[r.coupon_code]),s(document.body).trigger("update_checkout",{update_shipping_method:!1})):e.result&&"error"===e.result&&(u(e.message,o),(n=document.querySelector(i.couponAddedSectionSelector))&&d.unblockUI(n))}}))},d.removeCouponCode=function(e,o){var t,c;e&&""!=e&&(n(),t=Math.floor(1e3*Math.random()),o&&o.setAttribute(i.referenceIdAttribute,t),o=document.querySelector(i.couponAddedSectionSelector),d.blockUI(o),c={security:i.removeCouponCodeNonce,coupon_code:e,reference_id:t},s.ajax({type:"POST",url:fcSettings.wcAjaxUrl.replace("%%endpoint%%","fc_remove_coupon_code"),data:c,dataType:"json",success:function(e){var o;e.reference_id&&(o=document.querySelector("["+i.referenceIdAttribute+'="'+e.reference_id+'"]')),e.result&&"success"===e.result?(e.message&&"yes"!==i.suppressSuccessMessages&&u(e.message,o),s(document.body).trigger("wc_fragment_refresh"),s(document.body).trigger("removed_coupon_in_checkout",[c.coupon_code]),s(document.body).trigger("update_checkout",{update_shipping_method:!1})):e.result&&"error"===e.result&&(u(e.message,o),(e=document.querySelector(i.couponAddedSectionSelector))&&d.unblockUI(e))}}))};return d.init=function(e){l||(i=r(i,e),window.CollapsibleBlock?c():window.RequireBundle&&RequireBundle.require(["collapsible-block"],function(){c()}))},d});
//# sourceMappingURL=maps/checkout-coupons-205-beta-2.min.js.map
